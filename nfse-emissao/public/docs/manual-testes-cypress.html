<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome file</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="manual-de-testes-automatizados-com-cypress">Manual de Testes Automatizados com Cypress</h1>
<h2 id="introdução">Introdução</h2>
<p>Este documento descreve como utilizar os testes automatizados implementados com Cypress para o sistema NFSe-emissao. Os testes cobrem todas as funcionalidades principais do sistema, incluindo login, cadastro de prestadores, tomadores, serviços, emissão de notas fiscais e relatórios.</p>
<h2 id="pré-requisitos">Pré-requisitos</h2>
<ul>
<li>
<p>Node.js instalado (versão 16 ou superior)</p>
</li>
<li>
<p>NPM ou Yarn instalado</p>
</li>
<li>
<p>Projeto NFSe-emissao configurado e funcionando localmente</p>
</li>
</ul>
<h2 id="estrutura-dos-testes">Estrutura dos Testes</h2>
<p>Os testes estão organizados na pasta <code>cypress</code> na raiz do projeto, com a seguinte estrutura:</p>
<pre><code>
cypress/

├── e2e/ # Testes end-to-end

│ ├── login.cy.ts # Testes de login

│ ├── prestadores.cy.ts # Testes de prestadores

│ ├── tomadores.cy.ts # Testes de tomadores

│ ├── servicos.cy.ts # Testes de serviços

│ ├── nfse.cy.ts # Testes de emissão de NFSe

│ ├── relatorios.cy.ts # Testes de relatórios

│ ├── dashboard.cy.ts # Testes do dashboard

│ ├── navegacao.cy.ts # Testes de navegação

│ └── all-tests.cy.ts # Execução de todos os testes

├── fixtures/ # Dados de teste

│ ├── usuario.json # Dados de usuários

│ ├── prestador.json # Dados de prestadores

│ ├── tomador.json # Dados de tomadores

│ └── servico.json # Dados de serviços

└── support/ # Arquivos de suporte

├── commands.ts # Comandos personalizados

└── e2e.ts # Configurações para testes e2e

</code></pre>
<h2 id="configuração-inicial">Configuração Inicial</h2>
<p>Antes de executar os testes, é necessário configurar o ambiente:</p>
<ol>
<li>
<p>Certifique-se de que o sistema NFSe-emissao está rodando localmente na porta 3000</p>
</li>
<li>
<p>Verifique se os dados de teste em <code>cypress/fixtures</code> estão de acordo com o ambiente de testes</p>
</li>
</ol>
<h2 id="executando-os-testes">Executando os Testes</h2>

<h3 id="scripts-de-execucao">Scripts de Execução</h3>
<p>Para facilitar a execução dos testes, o projeto inclui scripts PowerShell prontos para uso:</p>

<table>
  <thead>
    <tr>
      <th>Script</th>
      <th>Descrição</th>
      <th>Quando Usar</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>executar-testes-cypress.ps1</code></td>
      <td>Instala o Cypress, verifica se o servidor está rodando e inicia o Cypress no modo interativo</td>
      <td>Para desenvolvimento e criação de testes com interface gráfica</td>
    </tr>
    <tr>
      <td><code>executar-testes-sem-limpar-cache.ps1</code></td>
      <td>Instala o Cypress e executa os testes em modo headless (sem interface gráfica)</td>
      <td>Para execução automática dos testes em ambientes de CI/CD</td>
    </tr>
  </tbody>
</table>

<p>Exemplos de uso:</p>

<pre class=" language-powershell"><code class="prism language-powershell">
# Para executar testes com interface gráfica (modo interativo)
.\executar-testes-cypress.ps1

# Para executar testes sem interface gráfica (modo headless)
.\executar-testes-sem-limpar-cache.ps1
</code></pre>

<p>Ao executar o script <code>executar-testes-cypress.ps1</code>, o Cypress será aberto em modo interativo, permitindo selecionar e executar os testes individualmente:</p>

<ol>
  <li>Selecione "E2E Testing" na tela inicial do Cypress</li>
  <li>Escolha o navegador "Electron" na próxima tela</li>
  <li>Clique em "Start E2E Testing in Electron"</li>
  <li>Selecione o arquivo de teste que deseja executar (ex: <code>login.cy.ts</code>)</li>
</ol>

<h3 id="executando-todos-os-testes">Executando todos os testes</h3>
<p>Para executar todos os testes de uma vez, use o comando:</p>
<pre class=" language-bash"><code class="prism  language-bash">
npx  cypress  run

</code></pre>
<h3 id="executando-testes-específicos">Executando testes específicos</h3>
<p>Para executar um teste específico, use o comando:</p>
<pre class=" language-bash"><code class="prism  language-bash">
npx  cypress  run  --spec  <span class="token string">"cypress/e2e/login.cy.ts"</span>

</code></pre>
<p>Substitua <code>login.cy.ts</code> pelo arquivo de teste que deseja executar.</p>
<h3 id="modo-interativo">Modo interativo</h3>
<p>Para abrir o Cypress em modo interativo, onde você pode selecionar os testes visualmente:</p>
<pre class=" language-bash"><code class="prism  language-bash">
npx  cypress  <span class="token function">open</span>

</code></pre>
<h2 id="adicionando-ao-package.json">Adicionando ao package.json</h2>
<p>Para facilitar a execução dos testes, você pode adicionar os seguintes scripts ao seu <code>package.json</code>:</p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"cypress:open"</span><span class="token punctuation">:</span> <span class="token string">"cypress open"</span><span class="token punctuation">,</span>

<span class="token string">"cypress:run"</span><span class="token punctuation">:</span> <span class="token string">"cypress run"</span><span class="token punctuation">,</span>

<span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token string">"cypress run"</span>

<span class="token punctuation">}</span>

</code></pre>
<p>Assim, você pode executar os testes com:</p>
<pre class=" language-bash"><code class="prism  language-bash">
<span class="token function">npm</span>  run  cypress:open  <span class="token comment"># Modo interativo</span>

<span class="token function">npm</span>  run  cypress:run  <span class="token comment"># Execução em linha de comando</span>

<span class="token function">npm</span>  <span class="token function">test</span>  <span class="token comment"># Atalho para cypress run</span>

</code></pre>
<h2 id="comandos-personalizados">Comandos Personalizados</h2>
<p>O projeto utiliza comandos personalizados do Cypress para facilitar a escrita dos testes. Abaixo estão os principais comandos disponíveis:</p>

<table>
  <thead>
    <tr>
      <th>Comando</th>
      <th>Descrição</th>
      <th>Exemplo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>cy.fazerLogin(username, password)</code></td>
      <td>Realiza o login no sistema</td>
      <td><code>cy.fazerLogin('admin', 'senha123')</code></td>
    </tr>
    <tr>
      <td><code>cy.irPara(rota)</code></td>
      <td>Navega para uma rota específica</td>
      <td><code>cy.irPara('/prestadores')</code></td>
    </tr>
    <tr>
      <td><code>cy.verificarTitulo(titulo)</code></td>
      <td>Verifica se o título da página está correto</td>
      <td><code>cy.verificarTitulo('Prestadores')</code></td>
    </tr>
    <tr>
      <td><code>cy.selecionarOpcao(seletor, valor)</code></td>
      <td>Seleciona uma opção em um select personalizado</td>
      <td><code>cy.selecionarOpcao('.select', 'Opção 1')</code></td>
    </tr>
    <tr>
      <td><code>cy.anexarArquivo(seletor, nomeArquivo, tipoArquivo)</code></td>
      <td>Anexa um arquivo a um input de arquivo</td>
      <td><code>cy.anexarArquivo('input[type="file"]', 'logo.png', 'image/png')</code></td>
    </tr>
  </tbody>
</table>

<p>Estes comandos estão definidos no arquivo <code>cypress/support/commands.ts</code> e os tipos estão declarados em <code>cypress/support/index.d.ts</code>.</p>

<h2 id="solucao-de-problemas">Solução de Problemas</h2>

<h3 id="erro-de-permissao">Erro de Permissão</h3>
<p>Se você encontrar erros relacionados a permissões ao executar o Cypress, tente usar o navegador Electron em vez do Chrome:</p>
<pre class=" language-bash"><code class="prism language-bash">
npx cypress run --browser electron
</code></pre>

<h3 id="erro-de-arquivo-bloqueado">Erro de Arquivo Bloqueado</h3>
<p>Se você encontrar erros como "resource busy or locked" ao limpar o cache do Cypress, tente:</p>
<ol>
  <li>Fechar todas as instâncias do Cypress em execução</li>
  <li>Executar o script sem limpar o cache: <code>executar-testes-sem-limpar-cache.ps1</code></li>
  <li>Se o problema persistir, reinicie o computador e tente novamente</li>
</ol>

<h3 id="problemas-de-codificacao">Problemas de Codificação de Caracteres</h3>
<p>Se você encontrar problemas com caracteres especiais nos arquivos de teste (como á, é, í, etc. aparecendo incorretamente), certifique-se de que todos os arquivos estão salvos com codificação UTF-8.</p>

<p>Para corrigir problemas de codificação, você pode usar o Visual Studio Code:</p>
<ol>
  <li>Abra o arquivo com problemas no VS Code</li>
  <li>Clique em "Salvar com Codificação" no menu inferior direito</li>
  <li>Selecione "UTF-8"</li>
  <li>Salve o arquivo</li>
</ol>

<p>É importante que todos os arquivos de teste estejam em UTF-8 para evitar problemas com caracteres especiais.</p>

<h3 id="erros-de-tipo">Erros de Tipo</h3>
<p>Se você encontrar erros de tipo relacionados aos comandos personalizados, verifique se o arquivo <code>cypress/support/index.d.ts</code> está configurado corretamente com as definições de tipo para todos os comandos personalizados.</p>

<h2 id="testes-implementados">Testes Implementados</h2>
<h3 id="testes-de-login">Testes de Login</h3>
<ul>
<li>
<p>Validação de campos obrigatórios</p>
</li>
<li>
<p>Validação de credenciais inválidas</p>
</li>
<li>
<p>Login bem-sucedido</p>
</li>
<li>
<p>Limite de caracteres nos campos</p>
</li>
</ul>
<h3 id="testes-de-prestadores">Testes de Prestadores</h3>
<ul>
<li>
<p>Listagem de prestadores</p>
</li>
<li>
<p>Criação de novo prestador</p>
</li>
<li>
<p>Edição de prestador existente</p>
</li>
<li>
<p>Inativação de prestador</p>
</li>
<li>
<p>Validação de campos obrigatórios</p>
</li>
<li>
<p>Validação de formato de CNPJ</p>
</li>
<li>
<p>Filtros na listagem</p>
</li>
</ul>
<h3 id="testes-de-tomadores">Testes de Tomadores</h3>
<ul>
<li>
<p>Listagem de tomadores</p>
</li>
<li>
<p>Criação de novo tomador</p>
</li>
<li>
<p>Edição de tomador existente</p>
</li>
<li>
<p>Inativação de tomador</p>
</li>
<li>
<p>Validação de campos obrigatórios</p>
</li>
<li>
<p>Validação de formato de CNPJ</p>
</li>
<li>
<p>Filtros na listagem</p>
</li>
</ul>
<h3 id="testes-de-serviços">Testes de Serviços</h3>
<ul>
<li>
<p>Listagem de serviços</p>
</li>
<li>
<p>Criação de novo serviço</p>
</li>
<li>
<p>Edição de serviço existente</p>
</li>
<li>
<p>Inativação de serviço</p>
</li>
<li>
<p>Validação de campos obrigatórios</p>
</li>
<li>
<p>Validação de formato de valores numéricos</p>
</li>
<li>
<p>Filtros na listagem</p>
</li>
</ul>
<h3 id="testes-de-emissão-de-nfse">Testes de Emissão de NFSe</h3>
<ul>
<li>
<p>Preenchimento do formulário de emissão</p>
</li>
<li>
<p>Validação de campos obrigatórios</p>
</li>
<li>
<p>Cálculo automático de valores</p>
</li>
<li>
<p>Adição e remoção de itens de serviço</p>
</li>
<li>
<p>Validação de formato de valores numéricos</p>
</li>
</ul>
<h3 id="testes-de-relatórios">Testes de Relatórios</h3>
<ul>
<li>
<p>Acesso aos diferentes relatórios</p>
</li>
<li>
<p>Preenchimento de filtros</p>
</li>
<li>
<p>Validação de datas</p>
</li>
<li>
<p>Geração de relatórios</p>
</li>
</ul>
<h3 id="testes-de-dashboard-e-navegação">Testes de Dashboard e Navegação</h3>
<ul>
<li>
<p>Exibição de cards e estatísticas</p>
</li>
<li>
<p>Navegação pelo menu lateral</p>
</li>
<li>
<p>Responsividade em dispositivos móveis</p>
</li>
<li>
<p>Logout</p>
</li>
<li>
<p>Redirecionamento para página não encontrada</p>
</li>
</ul>
<h2 id="manutenção-dos-testes">Manutenção dos Testes</h2>
<h3 id="atualizando-dados-de-teste">Atualizando Dados de Teste</h3>
<p>Os dados de teste estão localizados na pasta <code>cypress/fixtures</code>. Se houver mudanças no sistema que afetem os dados de teste, atualize os arquivos JSON correspondentes.</p>
<h3 id="adicionando-novos-testes">Adicionando Novos Testes</h3>
<p>Para adicionar novos testes:</p>
<ol>
<li>
<p>Crie um novo arquivo <code>.cy.ts</code> na pasta <code>cypress/e2e</code></p>
</li>
<li>
<p>Siga o padrão dos testes existentes</p>
</li>
<li>
<p>Use os comandos personalizados definidos em <code>cypress/support/commands.ts</code></p>
</li>
</ol>
<h3 id="comandos-personalizados">Comandos Personalizados</h3>
<p>Foram criados comandos personalizados para facilitar a escrita dos testes:</p>
<ul>
<li>
<p><code>cy.login(username, password)</code>: Realiza login no sistema</p>
</li>
<li>
<p><code>cy.navegarPara(rota)</code>: Navega para uma página específica</p>
</li>
<li>
<p><code>cy.verificarPagina(titulo)</code>: Verifica se está na página correta</p>
</li>
<li>
<p><code>cy.selecionarItem(seletor, valor)</code>: Seleciona um item em um select personalizado</p>
</li>
</ul>
<h2 id="boas-práticas">Boas Práticas</h2>
<ol>
<li>
<p>Mantenha os testes independentes entre si</p>
</li>
<li>
<p>Use dados de teste que não afetem o ambiente de produção</p>
</li>
<li>
<p>Limpe os dados após os testes quando necessário</p>
</li>
<li>
<p>Mantenha os seletores CSS atualizados</p>
</li>
<li>
<p>Evite dependências entre testes</p>
</li>
<li>
<p>Use timeouts adequados para operações assíncronas</p>
</li>
</ol>
<h2 id="solução-de-problemas">Solução de Problemas</h2>
<h3 id="testes-falhando-devido-a-elementos-não-encontrados">Testes falhando devido a elementos não encontrados</h3>
<ul>
<li>
<p>Verifique se os seletores CSS estão corretos</p>
</li>
<li>
<p>Aumente o timeout para elementos que demoram a carregar</p>
</li>
<li>
<p>Verifique se a aplicação está rodando corretamente</p>
</li>
</ul>
<h3 id="testes-lentos">Testes lentos</h3>
<ul>
<li>
<p>Reduza o número de interações com a UI</p>
</li>
<li>
<p>Use rotas personalizadas para preparar o estado da aplicação</p>
</li>
<li>
<p>Agrupe testes relacionados</p>
</li>
</ul>
<h3 id="erros-de-autenticação">Erros de autenticação</h3>
<ul>
<li>
<p>Verifique se os dados de login em <code>cypress/fixtures/usuario.json</code> estão corretos</p>
</li>
<li>
<p>Certifique-se de que o sistema de autenticação está funcionando corretamente</p>
</li>
</ul>
<h2 id="conclusão">Conclusão</h2>
<p>Os testes automatizados com Cypress ajudam a garantir a qualidade do sistema NFSe-emissao, permitindo identificar problemas rapidamente durante o desenvolvimento. Mantenha os testes atualizados conforme o sistema evolui para garantir sua eficácia.</p>
</div>
</body>

</html>
