<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome file</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="manual-da-api-de-nfse---prefeitura-de-belo-horizonte">Manual da API de NFSe - Prefeitura de Belo Horizonte</h1>
<h2 id="índice">Índice</h2>
<ol>
<li>
<p><a href="#introdu%C3%A7%C3%A3o">Introdução</a></p>
</li>
<li>
<p><a href="#autentica%C3%A7%C3%A3o">Autenticação</a></p>
</li>
<li>
<p><a href="#ambientes">Ambientes</a></p>
</li>
<li>
<p><a href="#endpoints">Endpoints</a></p>
</li>
</ol>
<ul>
<li>
<p><a href="#1-autentica%C3%A7%C3%A3o">Autenticação</a></p>
</li>
<li>
<p><a href="#2-cancelar-nfse">Cancelar NFSe</a></p>
</li>
<li>
<p><a href="#3-consultar-lote-rps">Consultar Lote RPS</a></p>
</li>
<li>
<p><a href="#4-consultar-nfse-por-rps">Consultar NFSe por RPS</a></p>
</li>
<li>
<p><a href="#5-consultar-nfse">Consultar NFSe</a></p>
</li>
<li>
<p><a href="#6-consultar-situa%C3%A7%C3%A3o-lote-rps">Consultar Situação Lote RPS</a></p>
</li>
<li>
<p><a href="#7-emitir-nfse-direct">Emitir NFSe Direct</a></p>
</li>
<li>
<p><a href="#8-listar-nfse">Listar NFSe</a></p>
</li>
<li>
<p><a href="#9-relat%C3%B3rios">Relatórios</a></p>
</li>
<ul>
<li><p><a href="#91-relat%C3%B3rio-de-tomadores">Relatório de Tomadores</a></p></li>
<li><p><a href="#92-relat%C3%B3rio-de-servi%C3%A7os">Relatório de Serviços</a></p></li>
<li><p><a href="#93-relat%C3%B3rio-de-notas-fiscais">Relatório de Notas Fiscais</a></p></li>
<li><p><a href="#94-relat%C3%B3rio-de-logs">Relatório de Logs</a></p></li>
<li><p><a href="#95-relat%C3%B3rio-de-usu%C3%A1rios">Relatório de Usuários</a></p></li>
</ul>
<li>
<p><a href="#9-obter-dados-para-nfse">Obter Dados para NFSe</a></p>
</li>
<li>
<p><a href="#10-gerenciar-prestadores">Gerenciar Prestadores</a></p>
</li>
<li>
<p><a href="#11-gerenciar-tomadores">Gerenciar Tomadores</a></p>
</li>
<li>
<p><a href="#12-gerenciar-servi%C3%A7os">Gerenciar Serviços</a></p>
</li>
</ul>
<ol start="5">
<li>
<p><a href="#c%C3%B3digos-de-erro">Códigos de Erro</a></p>
</li>
<li>
<p><a href="#boas-pr%C3%A1ticas">Boas Práticas</a></p>
</li>
</ol>
<h2 id="introdução">Introdução</h2>
<p>Esta API permite a integração com o sistema de Nota Fiscal de Serviços Eletrônica (NFSe) da Prefeitura de Belo Horizonte. Através dela, é possível realizar todas as operações relacionadas à emissão, consulta e cancelamento de notas fiscais.</p>
<h2 id="autenticação">Autenticação</h2>
<p>Todas as requisições à API devem incluir um token de autenticação no header. Para obter o token:</p>
<ol>
<li>
<p>Faça uma requisição POST para <code>/api/authorization</code></p>
</li>
<li>
<p>Use o token retornado no header <code>Authorization</code> de todas as outras requisições</p>
</li>
</ol>
<pre class=" language-http"><code class="prism  language-http">
<span class="token header-name keyword">Authorization:</span> Bearer &lt;seu_token&gt;

</code></pre>

<h3 id="sistema-de-segurança">Sistema de Segurança</h3>
<p>O sistema implementa um robusto mecanismo de segurança baseado em JWT (JSON Web Token) com as seguintes características:</p>
<ul>
<li>Tokens JWT com expiração de 1 hora</li>
<li>Armazenamento seguro em cookies HTTP-only e localStorage</li>
<li>Verificação de autenticação em todas as rotas e APIs</li>
<li>Controle de acesso baseado em papéis (RBAC)</li>
</ul>

<h3 id="tipos-de-usuários">Tipos de Usuários</h3>
<p>O sistema possui três tipos de usuários com diferentes níveis de permissão:</p>

<h4 id="usuário-master">Usuário Master</h4>
<p>Tem acesso completo ao sistema e pode gerenciar todos os prestadores e usuários.</p>
<p><strong>Credenciais padrão:</strong> usuário: <code>master</code>, senha: <code>master123</code></p>

<h4 id="usuário-administrador">Usuário Administrador</h4>
<p>Tem acesso limitado ao prestador ao qual está vinculado e pode gerenciar usuários desse prestador.</p>
<p><strong>Credenciais padrão:</strong> usuário: <code>admin</code>, senha: <code>admin</code></p>

<h4 id="usuário-comum">Usuário Comum</h4>
<p>Tem acesso limitado às funcionalidades básicas do sistema e está vinculado a um prestador específico.</p>
<p><strong>Credenciais padrão:</strong> usuário: <code>usuario</code>, senha: <code>usuario</code></p>

<h3 id="restrições-de-acesso">Restrições de Acesso</h3>
<p>As APIs implementam as seguintes restrições de acesso:</p>
<ul>
<li>Apenas usuários autenticados podem acessar as APIs</li>
<li>Usuários Master podem acessar todas as APIs</li>
<li>Usuários Administrador e Comum têm acesso restrito às APIs relacionadas ao seu prestador</li>
<li>Não é possível criar ou modificar usuários com perfil Master via API</li>
</ul>
<h2 id="ambientes">Ambientes</h2>
<p>A API possui dois ambientes:</p>
<p>| Código | Ambiente | Descrição |</p>
<p>|--------|-------------|------------------------------------------------|</p>
<p>| 1 | Produção | Ambiente real, gera notas fiscais válidas |</p>
<p>| 2 | Homologação | Ambiente de testes, não gera notas fiscais reais |</p>
<h2 id="endpoints">Endpoints</h2>
<h3 id="autenticação-1">1. Autenticação</h3>
<p><strong>Endpoint:</strong>  <code>/api/authorization</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"authKey"</span><span class="token punctuation">:</span> <span class="token string">"senha_de_acesso"</span>

<span class="token punctuation">}</span>

</code></pre>
<p><strong>Response:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"token"</span><span class="token punctuation">:</span> <span class="token string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."</span><span class="token punctuation">,</span>

<span class="token string">"expiresIn"</span><span class="token punctuation">:</span> <span class="token number">3600</span>

<span class="token punctuation">}</span>

</code></pre>
<h3 id="cancelar-nfse">2. Cancelar NFSe</h3>
<p><strong>Endpoint:</strong>  <code>/api/nfse/cancelar-nfse</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"ambiente"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>

<span class="token string">"numeroNfse"</span><span class="token punctuation">:</span> <span class="token string">"202500000000009"</span><span class="token punctuation">,</span>

<span class="token string">"cnpj"</span><span class="token punctuation">:</span> <span class="token string">"05065736000161"</span><span class="token punctuation">,</span>

<span class="token string">"inscricaoMunicipal"</span><span class="token punctuation">:</span> <span class="token string">"01733890014"</span><span class="token punctuation">,</span>

<span class="token string">"codigoCancelamento"</span><span class="token punctuation">:</span> <span class="token string">"2"</span>

<span class="token punctuation">}</span>

</code></pre>
<p><strong>Códigos de Cancelamento:</strong></p>
<ul>
<li>
<p>1: Erro na emissão</p>
</li>
<li>
<p>2: Serviço não prestado</p>
</li>
<li>
<p>3: Duplicidade da nota</p>
</li>
<li>
<p>4: Outros</p>
</li>
</ul>
<p><strong>Response:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

<span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"NFSe cancelada com sucesso"</span><span class="token punctuation">,</span>

<span class="token string">"protocolo"</span><span class="token punctuation">:</span> <span class="token string">"ABC123456789"</span>

<span class="token punctuation">}</span>

</code></pre>
<h3 id="consultar-lote-rps">3. Consultar Lote RPS</h3>
<p><strong>Endpoint:</strong>  <code>/api/nfse/consultar-lote-rps</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"ambiente"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>

<span class="token string">"Prestador"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"Cnpj"</span><span class="token punctuation">:</span> <span class="token string">"05065736000161"</span><span class="token punctuation">,</span>

<span class="token string">"InscricaoMunicipal"</span><span class="token punctuation">:</span> <span class="token string">"01733890014"</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"Protocolo"</span><span class="token punctuation">:</span> <span class="token string">"Ak0126637325J138VqvXS2mc"</span>

<span class="token punctuation">}</span>

</code></pre>
<p><strong>Response:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

<span class="token string">"situacao"</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>

<span class="token string">"mensagem"</span><span class="token punctuation">:</span> <span class="token string">"Lote processado com sucesso"</span><span class="token punctuation">,</span>

<span class="token string">"notas"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>

<span class="token punctuation">{</span>

<span class="token string">"numero"</span><span class="token punctuation">:</span> <span class="token string">"202500000000009"</span><span class="token punctuation">,</span>

<span class="token string">"codigoVerificacao"</span><span class="token punctuation">:</span> <span class="token string">"ABC123"</span><span class="token punctuation">,</span>

<span class="token string">"dataEmissao"</span><span class="token punctuation">:</span> <span class="token string">"2025-05-21T14:30:00Z"</span>

<span class="token punctuation">}</span>

<span class="token punctuation">]</span>

<span class="token punctuation">}</span>

</code></pre>
<h3 id="consultar-nfse-por-rps">4. Consultar NFSe por RPS</h3>
<p><strong>Endpoint:</strong>  <code>/api/nfse/consultar-nfse-por-rps</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"ambiente"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>

<span class="token string">"ConsultarNfseRpsEnvio"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"IdentificacaoRps"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"Numero"</span><span class="token punctuation">:</span> <span class="token string">"15"</span><span class="token punctuation">,</span>

<span class="token string">"Serie"</span><span class="token punctuation">:</span> <span class="token string">"HOMOL"</span><span class="token punctuation">,</span>

<span class="token string">"Tipo"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"Prestador"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"CpfCnpj"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"Cnpj"</span><span class="token punctuation">:</span> <span class="token string">"05065736000161"</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"InscricaoMunicipal"</span><span class="token punctuation">:</span> <span class="token string">"01733890014"</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre>
<p><strong>Response:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

<span class="token string">"nfse"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"numero"</span><span class="token punctuation">:</span> <span class="token string">"202500000000009"</span><span class="token punctuation">,</span>

<span class="token string">"codigoVerificacao"</span><span class="token punctuation">:</span> <span class="token string">"ABC123"</span><span class="token punctuation">,</span>

<span class="token string">"dataEmissao"</span><span class="token punctuation">:</span> <span class="token string">"2025-05-21T14:30:00Z"</span><span class="token punctuation">,</span>

<span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>

<span class="token string">"valorServicos"</span><span class="token punctuation">:</span> <span class="token number">1000.00</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre>
<h3 id="consultar-nfse">5. Consultar NFSe</h3>
<p><strong>Endpoint:</strong>  <code>/api/nfse/consultar-nfse</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"ambiente"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>

<span class="token string">"ConsultarNfseEnvio"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"Prestador"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"CpfCnpj"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"Cnpj"</span><span class="token punctuation">:</span> <span class="token string">"05065736000161"</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"InscricaoMunicipal"</span><span class="token punctuation">:</span> <span class="token string">"01733890014"</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"NumeroNfse"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>

<span class="token string">"Periodo"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"DataInicial"</span><span class="token punctuation">:</span> <span class="token string">"2025-01-01"</span><span class="token punctuation">,</span>

<span class="token string">"DataFinal"</span><span class="token punctuation">:</span> <span class="token string">"2025-12-31"</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre>
<p><strong>Response:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

<span class="token string">"notas"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>

<span class="token punctuation">{</span>

<span class="token string">"numero"</span><span class="token punctuation">:</span> <span class="token string">"202500000000009"</span><span class="token punctuation">,</span>

<span class="token string">"dataEmissao"</span><span class="token punctuation">:</span> <span class="token string">"2025-05-21T14:30:00Z"</span><span class="token punctuation">,</span>

<span class="token string">"valorServicos"</span><span class="token punctuation">:</span> <span class="token number">1000.00</span><span class="token punctuation">,</span>

<span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>

<span class="token punctuation">}</span>

<span class="token punctuation">]</span>

<span class="token punctuation">}</span>

</code></pre>
<h3 id="consultar-situação-lote-rps">6. Consultar Situação Lote RPS</h3>
<p><strong>Endpoint:</strong>  <code>/api/nfse/consultar-situacao-lote-rps</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"ambiente"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>

<span class="token string">"Prestador"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"Cnpj"</span><span class="token punctuation">:</span> <span class="token string">"05065736000161"</span><span class="token punctuation">,</span>

<span class="token string">"InscricaoMunicipal"</span><span class="token punctuation">:</span> <span class="token string">"01733890014"</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"Protocolo"</span><span class="token punctuation">:</span> <span class="token string">"Ak0126637325J138VqvXS2mc"</span>

<span class="token punctuation">}</span>

</code></pre>
<p><strong>Response:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

<span class="token string">"situacao"</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>

<span class="token string">"mensagem"</span><span class="token punctuation">:</span> <span class="token string">"Lote processado com sucesso"</span>

<span class="token punctuation">}</span>

</code></pre>
<p><strong>Códigos de Situação:</strong></p>
<ul>
<li>
<p>1: Não Recebido</p>
</li>
<li>
<p>2: Não Processado</p>
</li>
<li>
<p>3: Processado com Erro</p>
</li>
<li>
<p>4: Processado com Sucesso</p>
</li>
</ul>
<h3 id="emitir-nfse-direct">7. Emitir NFSe Direct</h3>
<p><strong>Endpoint:</strong>  <code>/api/nfse/emitir-nfse-direct</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"ambiente"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>

<span class="token string">"GerarNfseEnvio"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"Rps"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"InfRps"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"IdentificacaoRps"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"Numero"</span><span class="token punctuation">:</span> <span class="token string">"123"</span><span class="token punctuation">,</span>

<span class="token string">"Serie"</span><span class="token punctuation">:</span> <span class="token string">"HOMOL"</span><span class="token punctuation">,</span>

<span class="token string">"Tipo"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"DataEmissao"</span><span class="token punctuation">:</span> <span class="token string">"2025-05-21"</span><span class="token punctuation">,</span>

<span class="token string">"NaturezaOperacao"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>

<span class="token string">"OptanteSimplesNacional"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

<span class="token string">"IncentivadorCultural"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

<span class="token string">"Status"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>

<span class="token string">"Servico"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"Valores"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"ValorServicos"</span><span class="token punctuation">:</span> <span class="token number">100.00</span><span class="token punctuation">,</span>

<span class="token string">"IssRetido"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

<span class="token string">"BaseCalculo"</span><span class="token punctuation">:</span> <span class="token number">100.00</span><span class="token punctuation">,</span>

<span class="token string">"Aliquota"</span><span class="token punctuation">:</span> <span class="token number">0.05</span><span class="token punctuation">,</span>

<span class="token string">"ValorLiquidoNfse"</span><span class="token punctuation">:</span> <span class="token number">100.00</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"ItemListaServico"</span><span class="token punctuation">:</span> <span class="token string">"1401"</span><span class="token punctuation">,</span>

<span class="token string">"Discriminacao"</span><span class="token punctuation">:</span> <span class="token string">"Serviço de desenvolvimento de software"</span><span class="token punctuation">,</span>

<span class="token string">"CodigoMunicipio"</span><span class="token punctuation">:</span> <span class="token string">"3106200"</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"Prestador"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"CpfCnpj"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"Cnpj"</span><span class="token punctuation">:</span> <span class="token string">"05065736000161"</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"InscricaoMunicipal"</span><span class="token punctuation">:</span> <span class="token string">"01733890014"</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"Tomador"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"IdentificacaoTomador"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"CpfCnpj"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"Cpf"</span><span class="token punctuation">:</span> <span class="token string">"12345678900"</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"RazaoSocial"</span><span class="token punctuation">:</span> <span class="token string">"Nome do Cliente"</span><span class="token punctuation">,</span>

<span class="token string">"Endereco"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"Endereco"</span><span class="token punctuation">:</span> <span class="token string">"Rua Exemplo"</span><span class="token punctuation">,</span>

<span class="token string">"Numero"</span><span class="token punctuation">:</span> <span class="token string">"123"</span><span class="token punctuation">,</span>

<span class="token string">"Bairro"</span><span class="token punctuation">:</span> <span class="token string">"Centro"</span><span class="token punctuation">,</span>

<span class="token string">"CodigoMunicipio"</span><span class="token punctuation">:</span> <span class="token string">"3106200"</span><span class="token punctuation">,</span>

<span class="token string">"Uf"</span><span class="token punctuation">:</span> <span class="token string">"MG"</span><span class="token punctuation">,</span>

<span class="token string">"Cep"</span><span class="token punctuation">:</span> <span class="token string">"30100000"</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre>
<p><strong>Response:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

<span class="token string">"numeroNfse"</span><span class="token punctuation">:</span> <span class="token string">"202500000000010"</span><span class="token punctuation">,</span>

<span class="token string">"codigoVerificacao"</span><span class="token punctuation">:</span> <span class="token string">"XYZ789"</span><span class="token punctuation">,</span>

<span class="token string">"dataEmissao"</span><span class="token punctuation">:</span> <span class="token string">"2025-05-21T14:30:00Z"</span><span class="token punctuation">,</span>

<span class="token string">"protocolo"</span><span class="token punctuation">:</span> <span class="token string">"DEF987654321"</span>

<span class="token punctuation">}</span>

</code></pre>
<h2 id="códigos-de-erro">Códigos de Erro</h2>
<p>| Código | Descrição |</p>
<p>|--------|----------------------------------------------|</p>
<p>| 400 | Requisição inválida ou dados faltando |</p>
<p>| 401 | Não autorizado - Token inválido ou expirado |</p>
<p>| 404 | Recurso não encontrado |</p>
<p>| 500 | Erro interno do servidor |</p>
<h3 id="listar-nfse">8. Listar NFSe</h3>
<p><strong>Endpoint:</strong>  <code>/api/nfse/listar</code></p>
<p><strong>Método:</strong> GET</p>
<p><strong>Parâmetros de Consulta:</strong></p>
<ul>
<li>
<p><code>page</code>: Número da página (padrão: 1)</p>
</li>
<li>
<p><code>pageSize</code>: Quantidade de registros por página (padrão: 10)</p>
</li>
<li>
<p><code>filtro</code>: Texto para filtrar por número, série ou razão social do tomador</p>
</li>
<li>
<p><code>status</code>: Filtro por status da nota fiscal</p>
</li>
<li>
<p><code>dataInicio</code>: Data inicial para filtro (formato: YYYY-MM-DD)</p>
</li>
<li>
<p><code>dataFim</code>: Data final para filtro (formato: YYYY-MM-DD)</p>
</li>
</ul>
<p><strong>Response:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>

<span class="token punctuation">{</span>

<span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"123e4567-e89b-12d3-a456-426614174000"</span><span class="token punctuation">,</span>

<span class="token string">"numero"</span><span class="token punctuation">:</span> <span class="token string">"202500000000010"</span><span class="token punctuation">,</span>

<span class="token string">"serie"</span><span class="token punctuation">:</span> <span class="token string">"HOMOL"</span><span class="token punctuation">,</span>

<span class="token string">"dataEmissao"</span><span class="token punctuation">:</span> <span class="token string">"2025-05-21T14:30:00Z"</span><span class="token punctuation">,</span>

<span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>

<span class="token string">"valorServicos"</span><span class="token punctuation">:</span> <span class="token number">100.00</span><span class="token punctuation">,</span>

<span class="token string">"prestador"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"razaoSocial"</span><span class="token punctuation">:</span> <span class="token string">"Empresa Prestadora Ltda"</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token string">"tomador"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"razaoSocial"</span><span class="token punctuation">:</span> <span class="token string">"Cliente Exemplo"</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token string">"pagination"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>

<span class="token string">"total"</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>

<span class="token string">"page"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>

<span class="token string">"pageSize"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>

<span class="token string">"totalPages"</span><span class="token punctuation">:</span> <span class="token number">5</span>

<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre>
<h3 id="obter-dados-para-nfse">9. Obter Dados para NFSe</h3>
<p><strong>Endpoint:</strong>  <code>/api/nfse/dados</code></p>
<p><strong>Método:</strong> GET</p>
<p><strong>Response:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
<span class="token punctuation">{</span>

<span class="token string">"prestadores"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>

<span class="token punctuation">{</span>

<span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"123e4567-e89b-12d3-a456-426614174000"</span><span class="token punctuation">,</span>

<span class="token string">"razaoSocial"</span><span class="token punctuation">:</span> <span class="token string">"Empresa Prestadora Ltda"</span><span class="token punctuation">,</span>

<span class="token string">"cnpj"</span><span class="token punctuation">:</span> <span class="token string">"05065736000161"</span>

<span class="token punctuation">}</span>

<span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token string">"tomadores"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>

<span class="token punctuation">{</span>

<span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"123e4567-e89b-12d3-a456-426614174001"</span><span class="token punctuation">,</span>

<span class="token string">"razaoSocial"</span><span class="token punctuation">:</span> <span class="token string">"Cliente Exemplo"</span><span class="token punctuation">,</span>

<span class="token string">"cpfCnpj"</span><span class="token punctuation">:</span> <span class="token string">"12345678900"</span>

<span class="token punctuation">}</span>

<span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token string">"servicos"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>

<span class="token punctuation">{</span>

<span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"123e4567-e89b-12d3-a456-426614174002"</span><span class="token punctuation">,</span>

<span class="token string">"descricao"</span><span class="token punctuation">:</span> <span class="token string">"Serviço de desenvolvimento de software"</span><span class="token punctuation">,</span>

<span class="token string">"itemListaServico"</span><span class="token punctuation">:</span> <span class="token string">"1401"</span>

<span class="token punctuation">}</span>

<span class="token punctuation">]</span>

<span class="token punctuation">}</span>

</code></pre>
<h3 id="gerenciar-prestadores">10. Gerenciar Prestadores</h3>
<h4 id="criar-prestador">Criar Prestador</h4>
<p><strong>Endpoint:</strong>  <code>/api/prestadores/create</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<p>Enviar como FormData com os seguintes campos:</p>
<ul>
<li>
<p><code>cnpj</code>: CNPJ do prestador (sem formatação)</p>
</li>
<li>
<p><code>razaoSocial</code>: Razão social do prestador</p>
</li>
<li>
<p><code>nomeFantasia</code>: Nome fantasia (opcional)</p>
</li>
<li>
<p><code>inscricaoMunicipal</code>: Inscrição municipal</p>
</li>
<li>
<p><code>email</code>: Email de contato</p>
</li>
<li>
<p><code>telefone</code>: Telefone de contato</p>
</li>
<li>
<p><code>endereco</code>: Endereço</p>
</li>
<li>
<p><code>numero</code>: Número do endereço</p>
</li>
<li>
<p><code>complemento</code>: Complemento (opcional)</p>
</li>
<li>
<p><code>bairro</code>: Bairro</p>
</li>
<li>
<p><code>codigoMunicipio</code>: Código IBGE do município</p>
</li>
<li>
<p><code>uf</code>: UF</p>
</li>
<li>
<p><code>cep</code>: CEP (sem formatação)</p>
</li>
<li>
<p><code>serie</code>: Série para emissão de notas (padrão: “1”)</p>
</li>
<li>
<p><code>ambiente</code>: Ambiente (1: Produção, 2: Homologação)</p>
</li>
<li>
<p><code>optanteSimplesNacional</code>: “true” ou “false”</p>
</li>
<li>
<p><code>incentivadorCultural</code>: “true” ou “false”</p>
</li>
</ul>
<p><strong>Response:</strong></p>
<p>Redirecionamento para <code>/prestadores</code> em caso de sucesso.</p>
<h4 id="atualizar-prestador">Atualizar Prestador</h4>
<p><strong>Endpoint:</strong>  <code>/api/prestadores/update</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<p>Enviar como FormData com os mesmos campos de criação, mais o campo <code>id</code> do prestador.</p>
<p><strong>Response:</strong></p>
<p>Redirecionamento para <code>/prestadores</code> em caso de sucesso.</p>
<h3 id="gerenciar-tomadores">11. Gerenciar Tomadores</h3>
<h4 id="criar-tomador">Criar Tomador</h4>
<p><strong>Endpoint:</strong>  <code>/api/tomadores/create</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<p>Enviar como FormData com os seguintes campos:</p>
<ul>
<li>
<p><code>cpfCnpj</code>: CPF ou CNPJ do tomador (sem formatação)</p>
</li>
<li>
<p><code>tipo</code>: Tipo de pessoa (“F” para física, “J” para jurídica)</p>
</li>
<li>
<p><code>razaoSocial</code>: Nome ou Razão social do tomador</p>
</li>
<li>
<p><code>inscricaoMunicipal</code>: Inscrição municipal (opcional)</p>
</li>
<li>
<p><code>email</code>: Email de contato</p>
</li>
<li>
<p><code>telefone</code>: Telefone de contato (opcional)</p>
</li>
<li>
<p><code>endereco</code>: Endereço</p>
</li>
<li>
<p><code>numero</code>: Número do endereço</p>
</li>
<li>
<p><code>complemento</code>: Complemento (opcional)</p>
</li>
<li>
<p><code>bairro</code>: Bairro</p>
</li>
<li>
<p><code>codigoMunicipio</code>: Código IBGE do município</p>
</li>
<li>
<p><code>uf</code>: UF</p>
</li>
<li>
<p><code>cep</code>: CEP (sem formatação)</p>
</li>
</ul>
<p><strong>Response:</strong></p>
<p>Redirecionamento para <code>/tomadores</code> em caso de sucesso.</p>
<h4 id="atualizar-tomador">Atualizar Tomador</h4>
<p><strong>Endpoint:</strong>  <code>/api/tomadores/update</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<p>Enviar como FormData com os mesmos campos de criação, mais o campo <code>id</code> do tomador.</p>
<p><strong>Response:</strong></p>
<p>Redirecionamento para <code>/tomadores</code> em caso de sucesso.</p>
<h3 id="gerenciar-serviços">12. Gerenciar Serviços</h3>
<h4 id="criar-serviço">Criar Serviço</h4>
<p><strong>Endpoint:</strong>  <code>/api/servicos/create</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<p>Enviar como FormData com os seguintes campos:</p>
<ul>
<li>
<p><code>codigoTributacao</code>: Código de tributação</p>
</li>
<li>
<p><code>descricao</code>: Descrição do serviço</p>
</li>
<li>
<p><code>itemListaServico</code>: Item da lista de serviços</p>
</li>
<li>
<p><code>codigoCnae</code>: Código CNAE (opcional)</p>
</li>
<li>
<p><code>codigoNbs</code>: Código NBS (opcional)</p>
</li>
<li>
<p><code>unidade</code>: Unidade de medida</p>
</li>
<li>
<p><code>valorUnitario</code>: Valor unitário do serviço</p>
</li>
<li>
<p><code>codigoMunicipio</code>: Código IBGE do município</p>
</li>
<li>
<p><code>exigibilidadeIss</code>: Código de exigibilidade do ISS</p>
</li>
<li>
<p><code>aliquota</code>: Alíquota em porcentagem</p>
</li>
<li>
<p><code>issRetido</code>: “true” ou “false”</p>
</li>
</ul>
<p><strong>Response:</strong></p>
<p>Redirecionamento para <code>/servicos</code> em caso de sucesso.</p>
<h4 id="atualizar-serviço">Atualizar Serviço</h4>
<p><strong>Endpoint:</strong>  <code>/api/servicos/update</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Request:</strong></p>
<p>Enviar como FormData com os mesmos campos de criação, mais o campo <code>id</code> do serviço.</p>
<p><strong>Response:</strong></p>
<p>Redirecionamento para <code>/servicos</code> em caso de sucesso.</p>
<h2 id="9-relat%C3%B3rios">9. Relatórios</h2>
<p>O sistema oferece endpoints para geração de relatórios em formato PDF.</p>

<h3 id="91-relat%C3%B3rio-de-tomadores">9.1 Relatório de Tomadores</h3>
<p><strong>Endpoint:</strong> <code>/api/relatorios/tomadores</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Descrição:</strong> Gera um relatório em PDF de tomadores cadastrados no sistema.</p>

<p><strong>Request:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
{
  "prestadorId": "e951a265-cdf8-4f7c-8b30-482a56e082a8",
  "filtros": {
    "nome": "Empresa XYZ",
    "cpfCnpj": "12345678000199",
    "codigoMunicipio": "3106200",
    "dataInicio": "2025-01-01",
    "dataFim": "2025-05-31"
  }
}
</code></pre>

<p><strong>Response:</strong></p>
<p>Retorna um arquivo PDF com o relatório de tomadores.</p>

<h3 id="92-relat%C3%B3rio-de-servi%C3%A7os">9.2 Relatório de Serviços</h3>
<p><strong>Endpoint:</strong> <code>/api/relatorios/servicos</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Descrição:</strong> Gera um relatório em PDF de serviços cadastrados no sistema.</p>

<p><strong>Request:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
{
  "prestadorId": "e951a265-cdf8-4f7c-8b30-482a56e082a8",
  "filtros": {
    "codigo": "1.01",
    "descricao": "Desenvolvimento",
    "dataInicio": "2025-01-01",
    "dataFim": "2025-05-31"
  }
}
</code></pre>

<p><strong>Response:</strong></p>
<p>Retorna um arquivo PDF com o relatório de serviços.</p>

<h3 id="93-relat%C3%B3rio-de-notas-fiscais">9.3 Relatório de Notas Fiscais</h3>
<p><strong>Endpoint:</strong> <code>/api/relatorios/notasFiscais</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Descrição:</strong> Gera um relatório em PDF de notas fiscais emitidas no sistema.</p>

<p><strong>Request:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
{
  "prestadorId": "e951a265-cdf8-4f7c-8b30-482a56e082a8",
  "filtros": {
    "tomadorId": "f8a72b45-9d31-4c5e-b8a7-1e5f9a2c7d3e",
    "numero": "202500000000009",
    "status": "Emitida",
    "dataInicio": "2025-01-01",
    "dataFim": "2025-05-31"
  }
}
</code></pre>

<p><strong>Response:</strong></p>
<p>Retorna um arquivo PDF com o relatório de notas fiscais.</p>

<h3 id="94-relat%C3%B3rio-de-logs">9.4 Relatório de Logs</h3>
<p><strong>Endpoint:</strong> <code>/api/relatorios/logs</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Descrição:</strong> Gera um relatório em PDF de logs do sistema para auditoria.</p>

<p><strong>Request:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
{
  "prestadorId": "e951a265-cdf8-4f7c-8b30-482a56e082a8",
  "filtros": {
    "usuarioId": "a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6",
    "entidade": "Prestador",
    "acao": "Criar",
    "tela": "Cadastro de Prestador",
    "dataInicio": "2025-01-01",
    "dataFim": "2025-05-31"
  }
}
</code></pre>

<p><strong>Response:</strong></p>
<p>Retorna um arquivo PDF com o relatório de logs.</p>

<h3 id="95-relat%C3%B3rio-de-usu%C3%A1rios">9.5 Relatório de Usuários</h3>
<p><strong>Endpoint:</strong> <code>/api/relatorios/usuarios</code></p>
<p><strong>Método:</strong> POST</p>
<p><strong>Descrição:</strong> Gera um relatório em PDF de usuários cadastrados no sistema.</p>

<p><strong>Request:</strong></p>
<pre class=" language-json"><code class="prism  language-json">
{
  "prestadorId": "e951a265-cdf8-4f7c-8b30-482a56e082a8",
  "filtros": {
    "nome": "João",
    "username": "joao.silva",
    "role": "Administrador",
    "dataInicio": "2025-01-01",
    "dataFim": "2025-05-31"
  }
}
</code></pre>

<p><strong>Response:</strong></p>
<p>Retorna um arquivo PDF com o relatório de usuários.</p>

<h2 id="códigos-de-erro-1">Códigos de Erro</h2>
<p>| Código | Descrição |</p>
<p>|--------|----------------------------------------------|</p>
<p>| 400 | Requisição inválida ou dados faltando |</p>
<p>| 401 | Não autorizado - Token inválido ou expirado |</p>
<p>| 404 | Recurso não encontrado |</p>
<p>| 500 | Erro interno do servidor |</p>
<h2 id="boas-práticas">Boas Práticas</h2>
<ol>
<li><strong>Ambiente de Testes</strong></li>
</ol>
<ul>
<li>
<p>Sempre teste primeiro no ambiente de homologação (ambiente=2)</p>
</li>
<li>
<p>Valide todos os cenários antes de usar em produção</p>
</li>
</ul>
<ol start="2">
<li><strong>Tratamento de Erros</strong></li>
</ol>
<ul>
<li>
<p>Implemente tratamento para todos os códigos de erro</p>
</li>
<li>
<p>Mantenha logs das requisições e respostas</p>
</li>
</ul>
<ol start="3">
<li><strong>Segurança</strong></li>
</ol>
<ul>
<li>
<p>Nunca compartilhe ou exponha tokens de autenticação</p>
</li>
<li>
<p>Armazene dados sensíveis de forma segura</p>
</li>
</ul>
<ol start="4">
<li><strong>Performance</strong></li>
</ol>
<ul>
<li>
<p>Implemente cache quando apropriado</p>
</li>
<li>
<p>Evite consultas desnecessárias</p>
</li>
</ul>
<ol start="5">
<li><strong>Validações</strong></li>
</ol>
<ul>
<li>
<p>Valide todos os dados antes de enviar</p>
</li>
<li>
<p>Verifique formatos de datas e valores</p>
</li>
<li>
<p>Certifique-se que CNPJs e Inscrições Municipais estão sem formatação</p>
</li>
</ul>
</div>
</body>

</html>
