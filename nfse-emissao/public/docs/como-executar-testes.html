<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome file</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="como-executar-os-testes-automatizados">Como Executar os Testes Automatizados</h1>
<p>Este documento explica como executar os testes automatizados do sistema NFSe-emissao utilizando o Cypress.</p>
<h2 id="pré-requisitos">Pré-requisitos</h2>
<ul>
<li>
<p>Node.js instalado (versão 16 ou superior)</p>
</li>
<li>
<p>NPM ou Yarn instalado</p>
</li>
<li>
<p>Projeto NFSe-emissao configurado e funcionando localmente</p>
</li>
</ul>
<h2 id="instalação-do-cypress">Instalação do Cypress</h2>
<p>Para instalar o Cypress, execute o seguinte comando no terminal:</p>
<pre class=" language-bash"><code class="prism  language-bash">
<span class="token function">npm</span>  <span class="token function">install</span>  cypress@14.4.0  cypress-file-upload  --save-dev

</code></pre>
<p>Se você encontrar problemas durante a instalação, pode tentar limpar o cache e reinstalar:</p>
<pre class=" language-bash"><code class="prism  language-bash">
npx  cypress  cache  <span class="token function">clear</span>

npx  cypress  <span class="token function">install</span>

</code></pre>
<p>Para simplificar o processo de instalação e execução, você pode usar os scripts PowerShell fornecidos:</p>
<h3 id="scripts-disponíveis">Scripts Disponíveis</h3>
<p>| Script | Descrição | Quando Usar |</p>
<p>|--------|-----------|------------|</p>
<p>| <code>executar-testes-cypress.ps1</code> | Limpa o cache, instala o Cypress, verifica se o servidor está rodando e inicia o Cypress no modo interativo | Para primeira execução ou quando precisar de uma instalação limpa |</p>
<p>| <code>executar-testes-sem-limpar-cache.ps1</code> | Instala o Cypress sem limpar o cache e executa os testes em modo headless | Para execução rápida ou quando há problemas com limpeza de cache |</p>
<h4 id="exemplos-de-uso">Exemplos de uso:</h4>
<pre class=" language-powershell"><code class="prism  language-powershell">
<span class="token comment"># Para primeira execução ou quando precisar de uma instalação limpa</span>

<span class="token punctuation">.</span>\executar<span class="token operator">-</span>testes<span class="token operator">-</span>cypress<span class="token punctuation">.</span>ps1

  

<span class="token comment"># Para execução rápida ou quando há problemas com limpeza de cache</span>

<span class="token punctuation">.</span>\executar<span class="token operator">-</span>testes<span class="token operator">-</span>sem<span class="token operator">-</span>limpar<span class="token operator">-</span>cache<span class="token punctuation">.</span>ps1

</code></pre>
<p>Estes scripts automatizam o processo de instalação e execução do Cypress com as configurações adequadas.</p>
<h2 id="comandos-personalizados">Comandos Personalizados</h2>
<p>O projeto utiliza comandos personalizados do Cypress para facilitar a escrita dos testes. Abaixo estão os principais comandos disponíveis:</p>
<p>| Comando | Descrição | Exemplo |</p>
<p>|---------|-----------|--------|</p>
<p>| <code>cy.fazerLogin(username, password)</code> | Realiza o login no sistema | <code>cy.fazerLogin('admin', 'senha123')</code> |</p>
<p>| <code>cy.irPara(rota)</code> | Navega para uma rota específica | <code>cy.irPara('/prestadores')</code> |</p>
<p>| <code>cy.verificarTitulo(titulo)</code> | Verifica se o título da página está correto | <code>cy.verificarTitulo('Prestadores')</code> |</p>
<p>| <code>cy.selecionarOpcao(seletor, valor)</code> | Seleciona uma opção em um select personalizado | <code>cy.selecionarOpcao('.select', 'Opção 1')</code> |</p>
<p>| <code>cy.anexarArquivo(seletor, nomeArquivo, tipoArquivo)</code> | Anexa um arquivo a um input de arquivo | <code>cy.anexarArquivo('input[type="file"]', 'logo.png', 'image/png')</code> |</p>
<p>Estes comandos estão definidos no arquivo <code>cypress/support/commands.ts</code> e os tipos estão declarados em <code>cypress/support/index.d.ts</code>.</p>
<h2 id="executando-os-testes">Executando os Testes</h2>
<h3 id="modo-interativo-interface-gráfica">Modo Interativo (Interface Gráfica)</h3>
<p>Para abrir o Cypress em modo interativo, onde você pode selecionar os testes visualmente:</p>
<pre class=" language-bash"><code class="prism  language-bash">
<span class="token function">npm</span>  run  cypress:open

</code></pre>
<p>Isso abrirá a interface gráfica do Cypress, onde você pode:</p>
<ol>
<li>
<p>Selecionar o tipo de teste (E2E ou Component)</p>
</li>
<li>
<p>Escolher o navegador para executar os testes</p>
</li>
<li>
<p>Visualizar e executar os testes individualmente</p>
</li>
</ol>
<h3 id="modo-headless-linha-de-comando">Modo Headless (Linha de Comando)</h3>
<p>Para executar todos os testes em modo headless, gerando relatórios e screenshots para testes que falharem.</p>
<pre class=" language-bash"><code class="prism  language-bash">
<span class="token function">npm</span>  run  cypress:run

</code></pre>
<p>Ou simplesmente:</p>
<pre class=" language-bash"><code class="prism  language-bash">
<span class="token function">npm</span>  <span class="token function">test</span>

</code></pre>
<h3 id="executando-testes-específicos">Executando Testes Específicos</h3>
<h2 id="solução-de-problemas">Solução de Problemas</h2>
<h3 id="erro-de-permissão">Erro de Permissão</h3>
<p>Se você encontrar erros relacionados a permissões ao executar o Cypress, tente usar o navegador Electron em vez do Chrome:</p>
<pre class=" language-bash"><code class="prism  language-bash">
npx  cypress  run  --browser  electron

</code></pre>
<h3 id="erro-de-arquivo-bloqueado">Erro de Arquivo Bloqueado</h3>
<p>Se você encontrar erros como “resource busy or locked” ao limpar o cache do Cypress, tente:</p>
<ol>
<li>
<p>Fechar todas as instâncias do Cypress em execução</p>
</li>
<li>
<p>Executar o script sem limpar o cache: <code>executar-testes-sem-limpar-cache.ps1</code></p>
</li>
<li>
<p>Se o problema persistir, reinicie o computador e tente novamente</p>
</li>
</ol>
<h3 id="erros-de-tipo">Erros de Tipo</h3>
<p>Se você encontrar erros de tipo relacionados aos comandos personalizados, verifique se o arquivo <code>cypress/support/index.d.ts</code> está configurado corretamente com as definições de tipo para todos os comandos personalizados.</p>
<h3 id="problemas-de-codificação-de-caracteres">Problemas de Codificação de Caracteres</h3>
<p>Se você encontrar problemas com caracteres especiais nos arquivos de teste (como á, é, í, etc. aparecendo incorretamente), execute o script de correção de codificação:</p>
<pre class=" language-powershell"><code class="prism  language-powershell">
<span class="token punctuation">.</span>\corrigir<span class="token operator">-</span>encoding<span class="token operator">-</span>simples<span class="token punctuation">.</span>ps1

</code></pre>
<p>Este script corrige problemas de codificação de caracteres nos arquivos de teste, garantindo que todos estejam em UTF-8 sem BOM. É importante que todos os arquivos de teste estejam em UTF-8 para evitar problemas com caracteres especiais.</p>
<p>Para executar um teste específico:</p>
<pre class=" language-bash"><code class="prism  language-bash">
npx  cypress  run  --spec  <span class="token string">"cypress/e2e/login.cy.ts"</span>

</code></pre>
<p>Substitua <code>login.cy.ts</code> pelo arquivo de teste que deseja executar.</p>
<h2 id="estrutura-dos-testes">Estrutura dos Testes</h2>
<p>Os testes estão organizados na pasta <code>cypress/e2e</code> e cobrem as seguintes funcionalidades:</p>
<ul>
<li>
<p><strong>login.cy.ts</strong>: Testes de autenticação</p>
</li>
<li>
<p><strong>prestadores.cy.ts</strong>: Testes de cadastro e gestão de prestadores</p>
</li>
<li>
<p><strong>tomadores.cy.ts</strong>: Testes de cadastro e gestão de tomadores</p>
</li>
<li>
<p><strong>servicos.cy.ts</strong>: Testes de cadastro e gestão de serviços</p>
</li>
<li>
<p><strong>nfse.cy.ts</strong>: Testes de emissão de notas fiscais</p>
</li>
<li>
<p><strong>relatorios.cy.ts</strong>: Testes de geração de relatórios</p>
</li>
<li>
<p><strong>dashboard.cy.ts</strong>: Testes do painel principal</p>
</li>
<li>
<p><strong>navegacao.cy.ts</strong>: Testes de navegação pelo sistema</p>
</li>
<li>
<p><strong>upload-logomarca.cy.ts</strong>: Testes de upload de logomarca</p>
</li>
<li>
<p><strong>all-tests.cy.ts</strong>: Execução de todos os testes em sequência</p>
</li>
</ul>
<h2 id="resultados-dos-testes">Resultados dos Testes</h2>
<p>Após a execução dos testes, o Cypress gera relatórios detalhados com:</p>
<ul>
<li>
<p>Número de testes executados</p>
</li>
<li>
<p>Número de testes bem-sucedidos e falhos</p>
</li>
<li>
<p>Tempo de execução</p>
</li>
<li>
<p>Capturas de tela em caso de falhas</p>
</li>
<li>
<p>Logs detalhados de cada etapa</p>
</li>
</ul>
<h2 id="solução-de-problemas-1">Solução de Problemas</h2>
<h3 id="problemas-de-permissão-ao-executar-o-cypress">Problemas de permissão ao executar o Cypress</h3>
<p>Se você encontrar erros de permissão como <code>EACCES</code> ao tentar executar o Cypress com o Chrome, tente as seguintes soluções:</p>
<ol>
<li><strong>Usar o script PowerShell personalizado</strong>:</li>
</ol>
<pre class=" language-powershell"><code class="prism  language-powershell">
<span class="token punctuation">.</span><span class="token operator">/</span>executar<span class="token operator">-</span>cypress<span class="token punctuation">.</span>ps1

</code></pre>
<p>Este script configura o Cypress para usar o navegador Electron embutido e evita problemas de permissão.</p>
<ol start="2">
<li><strong>Executar com o navegador Electron</strong>:</li>
</ol>
<pre class=" language-bash"><code class="prism  language-bash">
npx cypress <span class="token function">open</span> --browser electron

</code></pre>
<ol start="3">
<li><strong>Limpar o cache do Cypress</strong>:</li>
</ol>
<pre class=" language-bash"><code class="prism  language-bash">
npx cypress cache <span class="token function">clear</span>

</code></pre>
<p>E depois tente executar novamente.</p>
<ol start="4">
<li><strong>Configurar variáveis de ambiente</strong>:</li>
</ol>
<pre class=" language-powershell"><code class="prism  language-powershell">
<span class="token variable">$env</span>:CYPRESS_BROWSER = <span class="token string">"electron"</span>

<span class="token variable">$env</span>:ELECTRON_EXTRA_LAUNCH_ARGS = <span class="token string">"--no-sandbox"</span>

<span class="token variable">$env</span>:CYPRESS_NO_SANDBOX = <span class="token string">"1"</span>

npx cypress open

</code></pre>
<h3 id="testes-falhando-devido-a-elementos-não-encontrados">Testes falhando devido a elementos não encontrados</h3>
<ul>
<li>
<p>Verifique se os seletores CSS estão corretos</p>
</li>
<li>
<p>Aumente o timeout para elementos que demoram a carregar</p>
</li>
<li>
<p>Verifique se a aplicação está rodando corretamente na porta 3000</p>
</li>
</ul>
<h3 id="erros-de-autenticação">Erros de autenticação</h3>
<ul>
<li>
<p>Verifique se os dados de login em <code>cypress/fixtures/usuario.json</code> estão corretos</p>
</li>
<li>
<p>Certifique-se de que o sistema de autenticação está funcionando corretamente</p>
</li>
</ul>
<h3 id="erros-de-upload-de-arquivos">Erros de upload de arquivos</h3>
<ul>
<li>
<p>Verifique se os arquivos de teste existem em <code>cypress/fixtures</code></p>
</li>
<li>
<p>Certifique-se de que o componente de upload está funcionando corretamente</p>
</li>
</ul>
<h2 id="manutenção-dos-testes">Manutenção dos Testes</h2>
<p>Para manter os testes atualizados:</p>
<ol>
<li>
<p>Atualize os dados de teste em <code>cypress/fixtures</code> quando necessário</p>
</li>
<li>
<p>Atualize os seletores CSS se a interface do usuário mudar</p>
</li>
<li>
<p>Adicione novos testes para novas funcionalidades</p>
</li>
<li>
<p>Execute os testes regularmente para garantir que tudo continua funcionando</p>
</li>
</ol>
</div>
</body>

</html>
